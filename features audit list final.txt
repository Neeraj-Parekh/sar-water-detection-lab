features audit list final 1 


Advanced SAR Engineering Audit: Master Feature & Math Specification
Version: 2.0 (Updated with RFI Protocols & Ray-Tracing Physics)
Role: Lead SAR Engineering Consultant
Context: High-Precision Flood & Urban Monitoring (Sentinel-1 C-Band)
PART 1: THE MATHEMATICAL CORE (47 Methods)
The Engine (filter_engine.py)
1. Pre-Processing (Signal Conditioning & RFI)
Strict Physics Check: Speckle is multiplicative; RFI is additive. Filters must be applied in order: RFI Removal $\rightarrow$ Calibration $\rightarrow$ Speckle Filtering.
1.1 Radio Frequency Interference (RFI) Filter:
Logic: Detects impulsive noise from ground radars (C-band interference).
Math: Uses Fisherâ€™s Z-test for narrowband interference and Kullback-Leibler (KL) Divergence for wideband interference on raw noise pulses (Rank Echoes).
Action: Mask frequencies/pulses where $Z > T_{thresh}$ before image formation.
1.2 Refined Lee Filter:
Logic: Edge-preserving. Computes variance in 8 directional sub-windows (masks).
Math: $\hat{I} = \bar{I} + b(I - \bar{I})$. The weight $b$ and local stats $(\bar{I}, \text{var})$ are derived only from the sub-window with the lowest variance (most homogeneous) to avoid blurring edges.
1.3 Frost Filter:
Logic: Exponential damping based on distance from center.
Math: Kernel $m(x,y) = e^{-K \cdot C_I \cdot d(x,y)}$. $K$ is the Damping Factor (typically 2.0 for urban). High $C_I$ (edges) $\rightarrow$ rapid decay $\rightarrow$ no smoothing.
1.4 Gamma MAP Filter:
Logic: Bayesian approach. Assumes PDF of speckle is Gamma and PDF of signal is Gamma.
Math: Solves the cubic equation for the Maximum A Posteriori estimate. Best for preserving texture in agricultural zones.
1.5 BayesShrink Wavelet Denoise:
Logic: Transform domain.
Math: Log-transform $\rightarrow$ Wavelet Decomposition $\rightarrow$ Soft Thresholding. Threshold $T$ is adaptive per sub-band: $T = \hat{\sigma}_{noise}^2 / \hat{\sigma}_{signal}$. Superior to VisuShrink for retaining hydrologic connectivity.
2. Radiometric Thresholding (Pixel Statistics)
Strict Physics Check: Histograms in SAR are rarely bimodal (water is $< 10\%$). Methods assuming bimodality (Otsu) will fail.
2.1 Kittler-Illingworth (Min Error):
Math: Assumes water and land follow Gaussian distributions in dB scale. Minimizes the cost function $J(T)$ representing the classification error probability. Valid for unequal variance classes.
2.2 K-Distribution CFAR:
Logic: Constant False Alarm Rate for maritime/rough water.
Math: Models clutter tails using the K-distribution (Compound Gaussian: Speckle $\times$ Texture). Threshold set by integrating the PDF to meet a $P_{fa}$ (e.g., $10^{-4}$).
2.3 G0-Distribution Solver:
Logic: For extremely heterogeneous urban clutter.
Math: Uses Inverse Gamma for texture. Handles "impulsive" returns better than K-distribution in city centers.
2.4 Triangle Method (Zack):
Logic: Geometric. Good for unimodal histograms (dominated by land).
Math: Finds the pixel value maximizing the distance perpendicular to the line connecting the histogram peak and the tail.
2.5 Hysteresis Thresholding:
Logic: Spatial connectivity.
Math: Uses two thresholds $T_{high}$ and $T_{low}$. Pixels $< T_{low}$ are water. Pixels between $T_{low}$ and $T_{high}$ are water only if connected to a definite water pixel.
2.6 Adaptive Sauvola:
Logic: Local contrast. Handles incidence angle fading (near-range bright, far-range dark).
Math: $T(x,y) = \mu(x,y)$.
2.7 Maximum Entropy:
Math: Maximizes the sum of Shannon entropy of the foreground and background classes.
2.8 Otsuâ€™s Method:
Warning: Only valid if water fraction $> 10\%$. Fails on small rivers. Kept for legacy comparison.
3. Derived Indices (Polarimetric Physics)
3.1 Cross-Polarization Ratio (CPR): $\sigma^0_{VH} / \sigma^0_{VV}$. Reduces dependency on absolute calibration; highlights volume scattering (vegetation).
3.2 SDWI (Sentinel-1 Dual-Pol Water Index):
Formula: $K_{SDWI} = \ln(10 \cdot VV \cdot VH) - 8$.
Engineering Note: Inputs must be linear units, not dB. The "-8" is an empirical constant for C-band.
3.3 SWI (SAR Water Index): Polynomial approximation of optical MNDWI using $VV$ and $VH$.
3.4 Pseudo-Optical Synthesis (Deep Learning):
Method: U-Net or CycleGAN trained on coincident S1/S2 pairs.
Output: Synthetic NDWI map from SAR input. Allows "cloud-free" vegetation/water indexing even during storms.
4. Spatial & Textural (GLCM)
4.1 GLCM Entropy: Measures disorder. Smooth water = Low Entropy.
4.2 GLCM Variance: Measures contrast. Urban = High Variance.
4.3 Coefficient of Variation (CoV): $\sigma / \mu$ within window. Used as a homogeneity mask.
5. Structural & Geometric (Shape)
5.1 Touzi Ratio Edge Detector:
Physics: Ratio-based (CFAR). Gradient filters (Sobel) fail on SAR speckle.
Math: Computes ratio of averages $r = \mu_1 / \mu_2$ in rotating windows. Robust to multiplicative noise.
5.2 Frangi Vesselness:
Math: Hessian Matrix Eigenvalues ($\lambda_1, \lambda_2$). Detects tubular structures (Rivers) where $\lambda_1 \approx 0$ and $\lambda_2 \gg 0$.
5.3 SRAD (Speckle Reducing Anisotropic Diffusion):
Math: PDE-based. Diffusion coefficient $c(q)$ is a function of the Instantaneous CoV. Smooths homogeneous water, stops at banks.
5.4 Geodesic Active Contour (Morphological Snake):
Math: Evolves a curve to minimize energy based on image gradient Inverse Gaussian Gradient. Snaps to river banks.
6. Morphological (Topology)
6.1 Geodesic Reconstruction:
Use: Hole filling that preserves object boundaries (unlike standard Closing).
Math: Iterative dilation of a marker image constrained by a mask.
6.2 Area Opening: Removes bright speckle artifacts smaller than $N$ pixels.
6.3 Area Closing: Fills dark noise holes inside water bodies.
6.4 White Top-Hat: Extracts bright peaks (boats/debris) on dark water.
7. Hydro-Geomorphic (Physics/DEM)
7.1 HAND (Height Above Nearest Drainage):
Physics: Hydrologic normalization.
Algorithm: Normalized terrain relative to the nearest drainage network. Masks out "dark" radar shadows in high mountains that look like water.
7.2 Ray-Casting Shadow Mask: [Updated]
Algorithm: Iterative horizon check along azimuth lines using Orbital State Vectors and DEM.
Logic: If local elevation angle $<$ max previous elevation angle, pixel is Shadow.
7.3 Ray-Casting Layover Mask:
Algorithm: Checks for non-monotonic slant range distance.
7.4 TWI (Topographic Wetness Index): $\ln(a / \tan \beta)$. Propensity of a pixel to accumulate water.
7.5 Sink Filling: Condition DEM to remove artifacts before HAND/TWI.
8. Unsupervised (Clustering)
8.1 SLIC Superpixels:
Adaptation: Must use "compactness" parameter tuned for SAR ($<0.1$) and run on Refined Lee filtered data to avoid shattering on speckle.
8.2 K-Means: Initialization for classifiers.
9. Imbalance Handling (Synthetic Data)
9.1 Borderline-SMOTE:
Priority: Generates synthetic water pixels only at the water/land boundary (mixed pixels). Essential for edge precision.
9.2 ADASYN: Adaptive weighting.
9.3 Tomek Links: Undersampling to clean decision boundaries.
9.4 Random Undersampling: Last resort for massive datasets.
10. Classifiers
10.1 Random Forest: Handles non-linear decision boundaries (Intensity + Texture + DEM).
10.2 SVM (RBF Kernel): Good for small, complex training sets.
10.3 XGBoost: Gradient boosting, handles missing data (shadows).
10.4 k-NN: Baseline comparator.
11. Dimensionality Reduction
11.1 PCA: Decorrelate VV/VH.
11.2 LDA: Maximize class separability.
12. Active Learning
12.1 Fisher Distance Query: Selects pixels where the statistical distance (Fisher-Rao) between Water/Land classes is lowest (highest uncertainty) for human labeling.
PART 2: THE SOFTWARE FEATURE SET (39 Features)
The Cockpit (app.py) - Mapped to Python Libraries
A. Verification & QA Tools
Traffic Light QA: Checks Metadata + Data. Green: ENL > 4.0. Red: RFI detected (Fisher Z) or Near Noise Floor (NESZ).
Window Voting: Manual "Red/Green" toggle per tile.
Dual-View Geo-Sync:
Implementation: folium.plugins.DualMap or streamlit-folium with session state sync. Pan/Zoom locked S1 (Left) vs Optical/Map (Right).
Time-Machine Check: Fetches closest Sentinel-2 image (via pystac-client).
OSM Water Overlay: Fetches natural=water vector from OpenStreetMap (via osmnx) for baseline truth.
Swipe Comparison: streamlit-before-after component to peel back binary mask.
Blind Spot Alert: Overlays the Ray-Traced Shadow/Layover Mask (Red Hatch) generated by sarsen/snappy.
B. Manual Editing
Surgical Paintbrush:
Implementation: streamlit_drawable_canvas. Allows adding/removing pixels from the binary mask.
Surgical Eraser: Sets mask value to 0.
Polygon Lasso: Draw polygon $\rightarrow$ skimage.draw.polygon $\rightarrow$ update mask.
C. Visualization Modes
Interactive Histogram: altair or plotly. Draggable vertical lines updating threshold $T$.
Pixel Probe: Mouse-over tooltip: dB, HAND, Slope, Incidence Angle.
Confidence Map: Probability output from Random Forest ($0.0 - 1.0$).
Double-Bounce Detector:
Logic: Highlights pixels $> -5$ dB (VV) in urban zones (bright lines) often indicating flooded streets.
Depth Contour Grader: Maps HAND values to flood depth classes ($<1m$, $1-3m$, $>3m$).
Texture Inspector: Visualizes entropy or variance layer.
Flow Director: Visualizes D8 flow direction from DEM.
Reference Strip: Top sticky bar: VV, VH, DEM, Slope, HAND, QA.
D. Automation & Logic
Target Matcher: "Find threshold $T$ such that water fraction $\approx$ 15%".
Variety Generator: Runs 15 permutations of (Filter $\times$ Threshold) in 15 grid windows.
Filter Pipeline Editor: RefinedLee $\rightarrow$ Kittler $\rightarrow$ AreaOpening.
Logic Gate Editor:
Implementation: pandas.eval() or numpy boolean logic. (MaskA & MaskB) & ~Shadow.
Quad-Split Solver: Thresholds 4 image quadrants independently (handles incidence angle roll-off).
Stability Heatmap: Perturb threshold $T \pm 0.5$ dB. Map pixels that flip state (High Uncertainty).
Auto-Noise Tuner: Calibrates lower bounds using NESZ metadata.
Rough Water Comp: Switches to K-Distribution logic if $H > \text{threshold}$ (windy).
Shadow Hunter: Trigger Ray-Tracing calculation on demand.
Bank Snapper: Active Contour (Snake) initialization on threshold boundary.
Best-Band Selector: Computes Fisher Distance between Water/Land histograms for VV and VH. Selects max separability.
Island Protector: Topology check: "Don't remove small land objects inside water objects."
Sub-Pixel Map:
Algorithm: Backscatter Regression. $f_{water} = (I_{pixel} - \mu_{land}) / (\mu_{water} - \mu_{land})$. Clamped $$.
E. Workflow & Export
Golden Zipper: Export Mask.tif, Vectors.geojson, Metadata.json, Raw.tif.
Session State Saver: Serializes st.session_state to JSON.
Director's Cut: Merge strategies: Union (Optimistic), Intersection (Pessimistic), Vote.
Fusion Presets: Urban Flood (Double Bounce + HAND), Open Water (Kittler + VH).
Strict/Relaxed Switch: Morphological Dilation/Erosion buffer.
External Metadata Loader: aoi.geojson ingest.
Window Reset: Clear window state.
Versioning: Auto-increment export filenames.





*The Engine (`filter_engine.py`)*

**1. Pre-Processing (Speckle & Noise Suppression)**

* 1.1 **Refined Lee Filter:** Uses **8-directional sub-windows** to compute local variance; selects the most homogeneous sub-window to preserve edges while smoothing.
* 1.2 **Frost Filter:** Exponentially damped convolution kernel; uses a **Damping Factor ()** to adapt smoothing based on the local Coefficient of Variation (CoV).
* 1.3 **Gamma MAP Filter:** Maximum A Posteriori estimator; assumes speckle follows a Gamma distribution and signal follows a Gamma (or Gaussian) prior.
* 1.4 **BayesShrink Wavelet Denoise:** Sub-band adaptive thresholding in the wavelet domain; minimizes Bayesian risk (superior to VisuShrink for texture preservation).

**2. Radiometric Thresholding (Statistical Segmentation)**

* 2.1 **Kittler-Illingworth:** Minimum Error Thresholding; assumes a mixture of Gaussian distributions (in dB scale) and minimizes the classification error cost function .
* 2.2 **K-Distribution CFAR:** Constant False Alarm Rate detection; models sea clutter using the K-distribution (Compound Gaussian) to handle "spiky" heavy-tailed data.
* 2.3 **G0-Distribution Solver:** Models extremely heterogeneous clutter (e.g., urban areas) using the Inverse Gamma texture model; robust against impulsive noise.
* 2.4 **Otsuâ€™s Method:** Minimizes intra-class variance; effectively a special case of Kittler-Illingworth (valid only for bimodal histograms).
* 2.5 **Hysteresis Thresholding:** Dual-threshold connectivity; pixels between  and  are kept only if connected to a pixel  (Edge continuity).
* 2.6 **Local Adaptive Sauvola:** Computes thresholds within a sliding window based on local mean and standard deviation; handles uneven illumination (incidence angle fade).
* 2.7 **Maximum Entropy:** Selects threshold that maximizes the sum of the entropies of the foreground and background classes.
* 2.8 **Triangle Method (Zack):** Geometric approach for unimodal histograms (e.g., water-dominated scenes) where the "land" peak is absent.

**3. Derived Indices (Polarimetric Math)**

* 3.1 **Cross-Polarization Ratio (CPR):** . Increases separation between volume scattering (vegetation) and surface scattering (water).
* 3.2 **SDWI (Sentinel-1 Dual-Pol Water Index):** . Enhances water-land contrast by exploiting the low backscatter of water in both channels.
* 3.3 **SWI (SAR Water Index):** Polynomial approximation of optical MNDWI optimized for Sentinel-1:  weighted combination.
* 3.4 **Pseudo-NDWI:** Deep Learning generator (U-Net) trained to predict Optical NDWI from SAR input (allows "cloud-free" vegetation indexing).

**4. Spatial & Textural (GLCM / Neighborhood)**

* 4.1 **GLCM Entropy:** Measures randomness in the Gray-Level Co-occurrence Matrix; Water surfaces exhibit low entropy (high homogeneity).
* 4.2 **GLCM Variance:** Measures heterogeneity (dispersion of gray levels); High in urban/vegetation, low in calm water.
* 4.3 **Coefficient of Variation (CoV):** Ratio ; Key metric for edge detection and identifying heterogeneous clutter.

**5. Structural & Geometric (Shape Analysis)**

* 5.1 **Touzi Ratio Edge Detector:** CFAR-based ratio of averages (ROA); robust to multiplicative speckle noise (unlike gradient detectors like Sobel).
* 5.2 **Frangi Vesselness:** Multi-scale **Hessian matrix** analysis (Eigenvalues ) to detect tubular structures (rivers) while suppressing blobs.
* 5.3 **SRAD (Speckle Reducing Anisotropic Diffusion):** PDE-based diffusion using Instantaneous CoV as the edge-stopping function; smoothes homogeneous regions, sharpens edges.
* 5.4 **Morphological Geodesic Active Contour (GAC):** "Morphological Snakes"; evolves a curve to minimize energy based on image gradient, constrained by balloon force.

**6. Morphological (Binary Topology)**

* 6.1 **Geodesic Reconstruction:** Iterative dilation of a "marker" image into a "mask" image; used for **Hole Filling** without altering object shape.
* 6.2 **Area Opening:** Removes bright objects smaller than a pixel count threshold (speckle artifacts) without eroding boundaries.
* 6.3 **Area Closing:** Fills dark holes smaller than a threshold (intra-water noise) without dilating boundaries.
* 6.4 **White Top-Hat:** Extracts bright structures smaller than the structuring element (useful for identifying small boats/debris).

**7. Hydro-Geomorphic (Physics/DEM Integration)**

* 7.1 **HAND (Height Above Nearest Drainage):** Normalizes terrain relative to the drainage network; excludes false "flood" detections in high-elevation shadow zones.
* 7.2 **Ray-Traced Shadow Mask:** Uses orbital state vectors (Azimuth/Elevation) and DEM to strictly calculate geometric occlusions (Radar Shadow).
* 7.3 **Ray-Traced Layover Mask:** Detects geometric distortions where the foreslope is steeper than the incidence angle.
* 7.4 **TWI (Topographic Wetness Index):** ; Identifies potential water accumulation zones based on upstream area and local slope.
* 7.5 **Sink Filling:** Hydrologic conditioning of the DEM to remove spurious depressions before HAND/TWI calculation.

**8. Unsupervised (Clustering)**

* 8.1 **SLIC Superpixels:** Simple Linear Iterative Clustering adapted for SAR; clusters pixels in 5D space () with a **compactness** constraint.
* 8.2 **K-Means Clustering:** Iterative distance-based grouping; useful for initializing classes before supervised refinement.

**9. Imbalance Handling (Synthetic Sampling)**

* 9.1 **Borderline-SMOTE:** Generates synthetic samples *only* near the decision boundary (mixed pixels) rather than the class center; critical for SAR edge precision.
* 9.2 **ADASYN:** Adaptive Synthetic sampling; weights minority samples by their difficulty (density of majority neighbors).
* 9.3 **Tomek Links:** Under-sampling technique; removes pairs of nearest neighbors from opposite classes to clean up the decision boundary.
* 9.4 **Random Under-Sampling:** Randomly removes majority class samples to balance dataset size (fast, but risks data loss).

**10. Classical Classifiers (Supervised)**

* 10.1 **Random Forest:** Ensemble of decision trees; highly effective for handling non-linear SAR feature spaces (Intensity + Texture + DEM).
* 10.2 **SVM (RBF Kernel):** Projects data to higher dimensions; excellent for finding the optimal hyperplane in complex scattering scenarios.
* 10.3 **XGBoost:** Gradient boosting framework; handles missing data (e.g., masked shadows) and provides feature importance scores.
* 10.4 **k-NN (k-Nearest Neighbors):** Distance-based; simple benchmark, computationally expensive for large rasters.

**11. Dimensionality Reduction**

* 11.1 **PCA:** Principal Component Analysis; reduces redundancy between correlated bands (e.g., VV and VH).
* 11.2 **LDA:** Linear Discriminant Analysis; maximizes class separability (requires labeled data).

**12. Active Learning**

* 12.1 **Fisher Distance Query:** Selects unlabeled pixels where the statistical distance (Fisher-Rao) between candidate classes is minimal (highest uncertainty).

---

### PART 2: THE SOFTWARE FEATURE SET (39 Features)

*The Cockpit (`app.py`)*

**A. Verification & QA Tools**

1. **Traffic Light QA:** Computes **ENL** (Equivalent Number of Looks) and **NESZ** proximity. `ðŸŸ¢` High ENL/Signal, `ðŸŸ¡` Low ENL, `ðŸ”´` Thermal Noise Dominated.
2. **Window Voting:** "Red/Green" buttons per filter window to manually accept/reject local thresholding results.
3. **Dual-View Geo-Sync:** Split-screen map (SAR vs. Optical/Roads) with locked center/zoom for validation.
4. **Time-Machine Check:** Fetches closest-in-time Sentinel-2 (Optical) image to cross-reference water extent.
5. **OSM Water Overlay:** Vector overlay of OpenStreetMap "natural=water" tags as a baseline truth boundary.
6. **Swipe Comparison:** "Peel-back" slider to visually compare the Binary Mask against the Raw SAR Intensity.
7. **Blind Spot Alert:** Visual overlay of the **Ray-Traced Shadow/Layover Mask** (Red Hatching) to warn of invalid data.

**B. Manual Editing**
8.  **Surgical Paintbrush:** Interactive pixel addition (Brush sizes 1-20px) updating the binary mask state.
9.  **Surgical Eraser:** Manual pixel removal (set value to 0).
10. **Polygon Lasso:** Draw-to-fill/delete for rapid editing of large continuous regions (e.g., lakes).

**C. Visualization Modes**
11.  **Interactive Histogram:** Plot of Pixel Intensity Distribution with draggable vertical threshold lines (Kittler/Otsu visualization).
12.  **Pixel Probe:** Hover tooltip displaying `$\sigma^0_{VV}$ (dB)`, `$\sigma^0_{VH}$ (dB)`, `HAND (m)`, `Slope (deg)`.
13.  **Confidence Map:** Heatmap visualization of probability output from Classifiers (0.0 to 1.0).
14.  **Double-Bounce Detector:** Highlights high-intensity urban flood signatures (Bright lines) distinct from specular water (Dark).
15.  **Depth Contour Grader:** Visualizes HAND classes: `h1` (<1m), `h2` (1-3m), `h3` (>3m) as proxy for flood depth.
16.  **Texture Inspector:** Visualizes GLCM Entropy or Variance to distinguish smooth water from smooth tarmac/sand.
17.  **Flow Director:** Arrows derived from DEM Aspect/Flow Direction (D8 algorithm) to indicate drainage paths.
18.  **Reference Strip:** Sticky top row displaying thumbnails of `VV`, `VH`, `DEM`, `Slope`, `HAND`, `QA`.

**D. Automation & Logic**
19.  **Target Matcher:** Reverse solver: "Adjust threshold until water fraction = X%".
20.  **Variety Generator:** Auto-populates 15 windows with combinations of (Filter + Threshold + Morph) parameters.
21.  **Filter Pipeline Editor:** Node-based or Chain-list UI to stack operations (e.g., `RefinedLee -> Kittler -> AreaOpen`).
22.  **Logic Gate Editor:** Boolean algebra builder for combining masks: `(Mask A AND Mask B) AND NOT (Shadow Mask)`.
23.  **Quad-Split Solver:** Divides image into 4 quadrants to threshold separately (handles incidence angle variance across swath).
24.  **Stability Heatmap:** Perturbs threshold by  dB and maps pixels that flip state (indicates low confidence).
25.  **Auto-Noise Tuner:** Estimates noise floor from "No-Data" shadow regions to calibrate lower bounds.
26.  **Rough Water Comp:** Detects high-texture water (wind) and switches to K-Distribution thresholding.
27.  **Shadow Hunter:** On-demand execution of the Ray-Tracing Shadow algorithm for the current sun/satellite geometry.
28.  **Bank Snapper:** Active Contour (Snake) that initializes on the threshold mask and "snaps" to the high-gradient river bank.
29.  **Best-Band Selector:** Calculates **Fisher Distance** between Water/Land classes for VV and VH; auto-selects the band with higher separability.
30.  **Island Protector:** Topology check; prevents Morphological Opening from deleting small islands *inside* water bodies.
31.  **Sub-Pixel Map:** Uses regression (Random Forest) to estimate % water coverage for boundary pixels.

**E. Workflow & Export**
32.  **Golden Zipper:** Batch export package: `Binary_Mask.tif`, `GeoJSON_Vectors`, `Metadata.json`, `Confidence_Map.tif`.
33.  **Session State Saver:** Auto-serialization of the "Recipe" (Parameter set) to JSON for reproducibility.
34.  **Director's Cut:** Composite logic to merge "Window Voting" results (Union, Intersection, or Majority Vote).
35.  **Fusion Presets:** One-click configurations: `Urban Flood` (Strict), `Open Water` (Relaxed), `Disaster Response` (Balanced).
36.  **Strict/Relaxed Switch:** Buffer logic to expand/contract mask by 1 pixel (Morphological Dilation/Erosion).
37.  **External Metadata Loader:** Ingests `aoi.geojson` or `params.json` to configure the viewport and algorithms.
38.  **Window Reset:** "Trash" icon to clear specific window state.
39.  **Versioning:** Auto-incrementing filenames for exports (`_v1`, `_v2`) to prevent overwrite.
